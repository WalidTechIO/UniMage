/**
 * Fonction qui execute des tests sur le module tree
 */
int testModuleTree(image *img);

int testModuleTree(image * img){
    // Test Arbre Glib
    if(afficher_image(img) == -1) return -3;
    createBitmapFile("original.bmp", img);
    printf("\nConstruction d'un arbre de zpixel taille 5 recouvrant l'image faisant la moyenne des couleurs\n");
    GTree *tree = build(5, img, BUILD_MOYENNE);
    if(tree == NULL){
        return -1;
    }
    printf("\nCalcul du nb de noeuds puis parcourt en projetant le zpixel sur l'image (apres projection on free le zpixel car plus besoin)\n");
    if(projeter_arbre(tree, img) == -1){
        return -2;
    }
    if(afficher_image(img) == -1) return -3;
    printf("\nOn constate que la projection s'est bien effectué et on constate aussi que le gap n'a pas été modifier !\n");
    createBitmapFile("pixelisee.bmp", img);
    return 0;
}

void create_window(GtkApplication *application, gpointer user_data);

void test(int argc, char *argv[]);

void on_about(GtkApplication *application, gpointer user_data, GtkWidget *widget);

void close_about(GtkApplication *application, gpointer user_data, GtkWidget *widget);

// Test GTK Glade

void test(int argc, char *argv[])
{
    GtkApplication *app = gtk_application_new("un.image", G_APPLICATION_FLAGS_NONE);
    if (app == NULL)
        exit(1);

    g_signal_connect(app, "activate", G_CALLBACK(create_window), NULL);

    g_application_run(G_APPLICATION(app), argc, argv);

    g_object_unref(app);
}

void on_about(GtkApplication *application, gpointer user_data, GtkWidget *widget)
{
    printf("Clique sur a propos !\n");
    gtk_widget_show_all(widget);
}

void close_about(GtkApplication *application, gpointer user_data, GtkWidget *widget)
{
    printf("Fermeture a propos\n");
    gtk_widget_hide(widget);
}

void create_window(GtkApplication *application, gpointer user_data)
{
    GtkBuilder *builder = gtk_builder_new_from_file("ui.glade");
    GtkWidget *window = GTK_WIDGET(gtk_builder_get_object(builder, "window"));
    GtkWidget *about = GTK_WIDGET(gtk_builder_get_object(builder, "about"));
    GtkWidget *quit = GTK_WIDGET(gtk_builder_get_object(builder, "quit"));
    GtkWidget *aboutwindow = GTK_WIDGET(gtk_builder_get_object(builder, "aboutwindow"));
    GtkWidget *closeabout = GTK_WIDGET(gtk_builder_get_object(builder, "closeabout"));
    g_signal_connect(window, "destroy", G_CALLBACK(gtk_main_quit), NULL);
    g_signal_connect(quit, "activate", G_CALLBACK(gtk_main_quit), NULL);
    g_signal_connect(about, "activate", G_CALLBACK(on_about), aboutwindow);
    g_signal_connect(closeabout, "clicked", G_CALLBACK(close_about), aboutwindow);
    gtk_widget_show_all(window);
    gtk_main();
}